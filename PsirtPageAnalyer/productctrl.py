import json
from collections import namedtuple
from .models import Vulnerability, Product, ProdAndVulRelationship

class ProductCtrl():
    def getTheProductAndVulMap(self):
        prodVulMap = {}
        NamedPV = namedtuple('NamedPV', ['product', 'vulList'])
        pvrs = ProdAndVulRelationship.object.all()
        for r in pvrs:
            if prodVulMap.has_key(r.product.name) :
                prodVulMap[r.r.product.name].vulList.append(r.vul)
            else:
                prodVulMap[r.product.name] = NamedPV(r.product, [r.vul])
        return prodVulMap