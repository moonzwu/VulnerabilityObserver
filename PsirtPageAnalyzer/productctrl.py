import json
from .models import ProdAndVulRelationship, Product
from .utils import StringUtil


class ProductCtrl():
    def get_prod_vul_relationship_by_prod(self, product_name):
        product = Product.objects.get(name=product_name)
        pvrs = ProdAndVulRelationship.objects.filter(product=product)
        prodVulMap = {'product': product_name, 'vulList': [r.to_json() for r in pvrs if StringUtil.verifyUrl(r.downloadLink)]}
        return json.dumps(prodVulMap)
