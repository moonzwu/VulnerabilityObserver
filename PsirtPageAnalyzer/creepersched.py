import time
import datetime
from apscheduler.schedulers.background import BackgroundScheduler
from PsirtPageAnalyzer.pagecreeper import PsirtPageCreeper

class CreeperScheduler():
    index = 0
    sched = BackgroundScheduler()

    def creep_job(self):
        self.index += 1
        print('Start the ', self.index, ' round creep at ', datetime.datetime.now() )
        start_time = time.time()
        if PsirtPageCreeper().creep():
            print('Creep job running succeed.')
        else:
            print('Creep job has failed.')
        print('Total cost is ', time.time() - start_time)
        print('The creep job end.')

    def start_creep_scheduler(self, interval):
        jobs = self.sched.get_jobs();
        if len(jobs) > 0:
            self.sched.remove_job('creep_job')

        if interval == 0:
            self.creep_job()
        else:
            self.sched.add_job(self.creep_job, 'interval', hours=interval, id='creep_job')
            self.sched.start()