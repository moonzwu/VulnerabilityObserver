import base64

from django.http import HttpResponse
from .productctrl import  ProductCtrl
from .buctrl import BusinessUnitCtrl
from .vulctrl import VulnerabilityCtrl
from .creepersched import CreeperScheduler


def start_scheduler(request, interval=8):
    CreeperScheduler().start_creep_scheduler(int(interval))
    return HttpResponse("Succeed")


def business_units(request):
    return HttpResponse(BusinessUnitCtrl().get_all_bus(), content_type="application/json")

def vulnerabilities(request):
    return HttpResponse(VulnerabilityCtrl().get_all_vuls(), content_type="application/json")

def products_by_bu(request, bu_name):
    decoded_bu_name = base64.urlsafe_b64decode(bu_name.encode('ascii')).decode('ascii')
    bu_ctrl = BusinessUnitCtrl()
    json_data = bu_ctrl.get_relationships_by_bu(decoded_bu_name)
    return HttpResponse(json_data, content_type="application/json")

def vuls_by_product(request, prod_name):
    decoded_prod_name = base64.urlsafe_b64decode(prod_name.encode('ascii')).decode('ascii')
    prod_ctrl = ProductCtrl()
    json_data = prod_ctrl.get_prod_vul_relationship_by_prod(decoded_prod_name)
    return HttpResponse(json_data, content_type="application/json")