<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en-US">
<head>
    <title>Vulnerability Observer</title>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    {% load staticfiles %}
    <link rel="stylesheet" type="text/css" href="{% static 'PsirtPageAnalyzer/css/jquery.mobile-1.4.5.css' %}"/>
    <link rel="stylesheet" type="text/css" href="{% static 'PsirtPageAnalyzer/css/style.css' %}"/>

    <script src="{% static 'PsirtPageAnalyzer/js/jquery.min.js' %}"></script>
    <script src="{% static 'PsirtPageAnalyzer/js/jquery.mobile-1.4.5.js' %}"></script>
    <script src="{% static 'PsirtPageAnalyzer/js/Chart.js' %}"></script>
    <script src="{% static 'PsirtPageAnalyzer/js/underscore-min.js' %}"></script>
</head>
<body>
<div id="canvas-holder">
    <canvas id="chart-area" width="300" height="300"/>
</div>

<div id="chartjs-tooltip"></div>


<script>
    Chart.defaults.global.customTooltips = function (tooltip) {
        // Tooltip Element
        var tooltipEl = $('#chartjs-tooltip');
        // Hide if no tooltip
        if (!tooltip) {
            tooltipEl.css({
                opacity: 0
            });
            return;
        }
        // Set caret Position
        tooltipEl.removeClass('above below');
        tooltipEl.addClass(tooltip.yAlign);
        // Set Text
        tooltipEl.html(tooltip.text);
        // Find Y Location on page
        var top;
        if (tooltip.yAlign == 'above') {
            top = tooltip.y - tooltip.caretHeight - tooltip.caretPadding;
        } else {
            top = tooltip.y + tooltip.caretHeight + tooltip.caretPadding;
        }
        // Display, position, and set styles for font
        tooltipEl.css({
            opacity: 1,
            left: tooltip.chart.canvas.offsetLeft + tooltip.x + 'px',
            top: tooltip.chart.canvas.offsetTop + top + 'px',
            fontFamily: tooltip.fontFamily,
            fontSize: tooltip.fontSize,
            fontStyle: tooltip.fontStyle,
        });
    };
    var pieData = [{
        value: 300,
        color: "#F7464A",
        highlight: "#FF5A5E",
        label: "High"
    }, {
        value: 100,
        color: "#FDB45C",
        highlight: "#FFC870",
        label: "Medium"
    },
    {
        value: 50,
        color: "#46BFBD",
        highlight: "#5AD3D1",
        label: "Low"
    }];

    loadVulsData = function () {
        $.getJSON("api/vuls", function(vuls) {
            highCount = 0;
            mediumCount = 0;
            lowCount = 0;

            $.each(vuls, function(index) {
                obj = JSON.parse(vuls[index]);
                if (obj.severity == 1)
                    highCount++;
                else if (obj.severity == 2)
                    mediumCount++;
                else
                    lowCount++;
            });

            pieData[0].value = highCount;
            pieData[1].value = mediumCount;
            pieData[2].value = lowCount;

            var ctx2 = document.getElementById("chart-area").getContext("2d");
            window.myPie = new Chart(ctx2).Pie(pieData);
        });
    }

    $(document).ready(function () {
        loadVulsData();


    });

</script>
</body>
</html>