<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en-US">
<head>
    <title>Vulnerability Observer</title>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    {% load staticfiles %}
    <link rel="stylesheet" type="text/css" href="{% static 'PsirtPageAnalyzer/css/jquery.mobile-1.4.5.css' %}"/>
    <link rel="stylesheet" type="text/css" href="{% static 'PsirtPageAnalyzer/css/style.css' %}"/>
    <script src="{% static 'PsirtPageAnalyzer/js/jquery.min.js' %}"></script>
    <script src="{% static 'PsirtPageAnalyzer/js/jquery.mobile-1.4.5.js' %}"></script>
    <script src="{% static 'PsirtPageAnalyzer/js/Chart.js' %}"></script>
    <script src="{% static 'PsirtPageAnalyzer/js/underscore-min.js' %}"></script>
    <script src="{% static 'PsirtPageAnalyzer/js/app.js' %}"></script>
</head>

<body style="margin: 0">
<div id="summary-area">
    <div id="canvas-holder">
        <canvas id="pie-chart-area" width="300" height="300"/>
    </div>
    <div id="canvas-holder2">
        <canvas id="line-chart-area" width="400" height="300"/>
    </div>

    <div id="canvas-holder3">
        <canvas id="bar-chart-area" width="400" height="300"/>
    </div>
    <div id="chartjs-tooltip"></div>
</div>
<div id="detail-area">
    <a href="#popupBUSelection" data-rel="popup" data-position-to="sildeup"
       class="ui-btn ui-corner-all ui-btn-inline ui-icon-check ui-btn-icon-left ui-btn-a"
       data-transition="pop" id="buselection-btn">Brand</a>

    <div data-role="popup" id="popupBUSelection" data-theme="none" class="ui-corner-all">
        <fieldset data-role="controlgroup" style="margin: 0px;">
            {% for bu in bsus %}
                <input type="radio" name="radionname" id="{{ bu.radioname }}" value="{{ bu.key }}">
                <label for="{{ bu.radioname }}">{{ bu.name }}</label>
            {% endfor %}
        </fieldset>
    </div>

    <div class="ui-field-contain inline-search-block">
        <input type="search" name="searching" id="search-all" value="">
    </div>
    <div class="ui-input-btn ui-btn ui-corner-all inline-display">
        Search
        <input type="button" data-enhanced="true" value="Search">
    </div>
</div>
<div id="search-result-area">

</div>

<script>

    Chart.defaults.global.customTooltips = function (tooltip) {
        // Tooltip Element
        var tooltipEl = $('#chartjs-tooltip');
        // Hide if no tooltip
        if (!tooltip) {
            tooltipEl.css({
                opacity: 0
            });
            return;
        }

        // Set caret Position
        tooltipEl.removeClass('above below');
        tooltipEl.addClass(tooltip.yAlign);
        // Set Text
        tooltipEl.html(tooltip.text);
        // Find Y Location on page
        var top;
        if (tooltip.yAlign == 'above') {
            top = tooltip.y - tooltip.caretHeight - tooltip.caretPadding;
        } else {
            top = tooltip.y + tooltip.caretHeight + tooltip.caretPadding;
        }
        // Display, position, and set styles for font
        tooltipEl.css({
            opacity: 1,
            left: tooltip.chart.canvas.offsetLeft + tooltip.x + 'px',
            top: tooltip.chart.canvas.offsetTop + top + 'px',
            fontFamily: tooltip.fontFamily,
            fontSize: tooltip.fontSize,
            fontStyle: tooltip.fontStyle
        });
    };

    String.prototype.format = function () {
        var args = arguments;
        return this.replace(/\{(\d+)\}/g,
                function (m, i) {
                    return args[i];
                });
    };


    $(document).ready(function () {
        Psirt.init(document, window);
        Psirt.loadVulsData();
        Psirt.loadBUsData();

        $("label[for^='radionname-']").each(function (i, el) {
            $(el).bind('mouseup', function () {
                $("#search-all").attr("value",  this.textContent + ":");
            });
        });

        $("input[value='Search']").click(function() {
            var searchCondition = $("#search-all").val().split(':');
            var result = Psirt.search(searchCondition[0], searchCondition[1]);
        });

    });
</script>
</body>

</html>
